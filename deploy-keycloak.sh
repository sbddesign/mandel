#!/bin/bash

echo "üöÄ Deploying Keycloak to Render..."

# Check if we're in the right directory
if [ ! -f "keycloak/Dockerfile" ]; then
    echo "‚ùå Please run this script from the project root directory"
    exit 1
fi

echo "üìä Keycloak configuration:"
echo "   ‚úÖ Dockerfile created for Keycloak"
echo "   ‚úÖ Realm configuration with cashu-client"
echo "   ‚úÖ Test user: testuser / testpass123"
echo "   ‚úÖ Admin: admin / admin123"
echo ""
echo "üîß Keycloak features:"
echo "   ‚Ä¢ OpenID Connect discovery endpoint"
echo "   ‚Ä¢ cashu-client configured"
echo "   ‚Ä¢ Test user for authentication"
echo "   ‚Ä¢ Realm: cashu-realm"
echo ""
echo "üìù To deploy Keycloak to Render:"
echo ""
echo "1. Create a new web service in Render dashboard:"
echo "   ‚Ä¢ Name: mandel-keycloak"
echo "   ‚Ä¢ Runtime: Docker"
echo "   ‚Ä¢ Build Command: (leave empty)"
echo "   ‚Ä¢ Start Command: (leave empty)"
echo "   ‚Ä¢ Root Directory: keycloak"
echo ""
echo "2. Set environment variables:"
echo "   ‚Ä¢ KEYCLOAK_ADMIN=admin"
echo "   ‚Ä¢ KEYCLOAK_ADMIN_PASSWORD=admin123"
echo "   ‚Ä¢ KC_DB=dev-file"
echo "   ‚Ä¢ KC_HTTP_PORT=8080"
echo "   ‚Ä¢ KC_HOSTNAME_STRICT=false"
echo "   ‚Ä¢ KC_HOSTNAME_STRICT_HTTPS=false"
echo "   ‚Ä¢ KC_HTTP_ENABLED=true"
echo ""
echo "3. Update mint service environment:"
echo "   ‚Ä¢ CDK_MINTD_AUTH_OPENID_DISCOVERY=https://mandel-keycloak.onrender.com/realms/cashu-realm/.well-known/openid-configuration"
echo ""
echo "4. Test locally first:"
echo "   docker-compose -f docker-compose.dev.yml up -d"
echo "   # Access Keycloak at http://localhost:8080"
echo "   # Access mint at http://localhost:3338"
echo ""
echo "‚úÖ After deployment, your mint will support NUT-22 authentication!"
